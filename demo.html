<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>demo ed-location</title>
</head>
<body>
  <h1>demo ed-location</h1>
  <h2>Edit (edit.html)</h2>
  <iframe id="demo" src="./edit.html" width="480" height="360"></iframe>
  <h2>View (index.html)</h2>
  <iframe id="view" src="./index.html" width="480" height="360"></iframe>
  <h2>Block</h2>
  <pre id="blocktext"></pre>
  <button id="focus">focus</button>

  <script>
    var iframe = document.getElementById('demo')
    // Sending content to the editor
    iframe.addEventListener('load', function () {
      iframe.contentWindow.postMessage(
        { topic: 'setblock'
        , payload:
          { metadata:
            { geo: {latitude: 68.55260186877743, longitude: 22.666168212890625, zoom: 5}
            , address: 'Enonteki√∂, Lappi, Finland'
            }
          , id: 'uuid-loca-tion'
          , html: ''
          , type: 'location'
          }
        }
      , '*'
      )
    })
    // Receiving content from the editor
    window.addEventListener('message', function (message) {
      var iframe = document.getElementById('demo')
      var view = document.getElementById('view')
      var preview = document.getElementById('preview')
      var blocktext = document.getElementById('blocktext')

      switch (message.data.topic) {
        case 'changed':
          var block = message.data.payload
          if (block && block.metadata && block.metadata.isBasedOnUrl) {
            var search = block.metadata.isBasedOnUrl.split('?')[1]
            view.src = './index.html?' + search
          }
          blocktext.textContent = JSON.stringify(message.data.payload, null, 2)
          break
        case 'height':
          iframe.height = message.data.payload
        default:
          break
      }
    })

    // Focus demo
    document.getElementById('focus').onclick = function () {
      iframe.contentWindow.postMessage({topic: 'focus'}, '*')
    }
  </script>
</body>
</html>